# Amazon 商品信息抓取与上架优化方案（简版）

## 1. 目标

- 输入：一个或多个 Amazon 商品链接  
- 输出：
  - 商品结构化数据：标题、价格、图片、要点描述、详情、评分、评论摘要、关键词统计等  
  - 基于数据分析生成的：优化标题、优化 Bullet Points、描述建议、图片布局建议  
- 用途：辅助运营生成更优质的上架信息（Listing）

---

## 2. 抓取方案选择对比

### `product-scraper`

- 特点：
  - 很早期的 Node.js 电商抓取库，长期不维护  
  - 封装简单：传入 URL 返回标题、价格、图片、描述等基础信息  
- 问题：
  - 依赖写死的 DOM 选择器，已久未更新，极易失效  
  - 不支持现代反爬与动态渲染场景  
- 结论：仅适合 Demo，不适合构建可靠的 Amazon 抓取工具

### `puppeteer-ecommerce-scraper`

- 特点：
  - 基于 Puppeteer/Chromium 的通用电商抓取框架  
  - 支持前端动态渲染、分页、滚动、多任务并行  
  - 集成 `puppeteer-cluster`、stealth 插件、代理、profile 等反爬手段  
- 使用方式：
  - 提供 `clusterWrapper`、`scrapeWithPagination` 等函数  
  - 需要自己编写针对 Amazon 的 DOM 解析逻辑（如图片、评论、要点等）
- 结论：更适合与现有 TS/Node 技术栈结合，作为长期可维护的基础抓取层

---

## 3. 基本架构设计

### 后端（Node + TS + Puppeteer）

- 模块职责：
  - `抓取层`：用 Puppeteer 打开 Amazon 链接并提取原始数据  
  - `分析层`：基于原始数据做关键词统计、评论分析、Listing 优化建议  
- 核心接口示例：
  - `GET /api/amazon/parse?url=...`
    - 打开页面 → 按规则提取数据 → 结构化返回
  - `ProductRawData`（示例字段）：
    - `title`, `price`, `images[]`, `bullets[]`, `description`, `rating`, `reviewCount`, `reviews[]`

### 前端（集成到现有项目）

- 输入：Amazon 链接  
- 展示：
  - 原始抓取数据（标题、图、评论摘要、关键词云）  
  - 生成的优化 Listing（标题、Bullet Points、描述建议等）  
- 工具：导出 JSON/CSV/Excel，方便上架或与其他工具对接

---

## 4. DOM 变更应对策略（非 AI 自适应）

### 4.1 优先使用更稳定的数据源

- 尽量避免纯 CSS 结构定位  
- 优先从以下位置提取：
  - `JSON-LD` / `schema.org`（`<script type="application/ld+json">` 中的 `Product` 数据）  
  - `meta` 标签与 `data-*` 属性  
  - 带 `id` / `data-hook` / `aria-*` 等语义属性的元素

### 4.2 规则配置化与多候选 Selector

- 统一维护 `amazonSelectors` 配置，而不是在代码里分散写 selector  
- 每个字段允许多个候选 selector，按顺序尝试，并对结果做基本校验（如价格格式）  
- DOM 微调时，只需修改配置而非业务代码

### 4.3 文本/语义驱动定位

- 通过文本定位模块，例如先找到包含 “Customer reviews” 文本的区域，再在其下查找评分和评论数量  
- 避免依赖 `nth-child` 之类的脆弱路径选择器

### 4.4 健康检查与监控

- 维护一批固定 ASIN 作为测试样本  
- 定时任务定期抓取，校验关键字段是否完整/合理  
- 报警机制：
  - 连续失败或关键字段为空/异常即通知开发  
- 错误时记录 DOM 片段或截图，方便快速修复规则

### 4.5 抓取与优化解耦

- 抓取层只负责输出 `ProductRawData`  
- 优化层只消费结构化数据，与页面结构无关  
- DOM 变更时，只需修抓取层，优化逻辑保持不变

---

## 5. 引入 AI 的自适应规则更新流程

在上述“规则驱动”架构基础上，可以增加一层 AI 协助：

### 5.1 基本想法

- 正常流程：  
  1. 使用当前配置的抓取规则 + Puppeteer 尝试提取数据  
  2. 若成功且通过校验，直接返回结果  
- 失败流程：  
  1. 将相关 DOM 片段（或精简过的 HTML）和当前规则配置发送给 AI  
  2. 让 AI 基于新的 DOM 结构，生成或修正规则（如更新 selector 配置）  
  3. 更新规则配置，重新尝试抓取  
  4. 若成功，将新规则持久化（用于后续请求）

### 5.2 关键点

- 只传“相关 DOM 片段”给 AI：
  - 比如商品标题区域、价格区域、图片区域、评论模块等  
- AI 输出：
  - 新的 selector 配置或规则片段（如：`title: ['#newTitleId', 'h1 span.a-size-large']`）  
- 规则审批：
  - 可以先在开发/测试环境下人工确认，再推广到线上  
  - 或设置安全阈值（如仅在测试样本上多次成功后自动启用）

### 5.3 优势

- 日常小改版（class 名或节点结构轻微调整）可以自动自愈  
- 减少人工频繁调试选择器的工作量  
- 保持整个系统的主体仍然是“规则驱动、可控、可观测”，AI 只负责辅助更新配置

---

## 6. 综合总结

- 抓取框架选型：  
  - 不建议使用老旧的 `product-scraper`；  
  - 结合当前技术栈与需求，使用 `puppeteer-ecommerce-scraper` + 自定义 Amazon 解析更合理。  
- DOM 变动问题：  
  - 通过结构化数据优先、规则配置化、多候选 selector、文本语义定位、监控与校验等手段，降低 DOM 变更带来的风险。  
- AI 自适应方案：  
  - 先用系统规则尝试抓取；  
  - 失败时把相关 DOM 片段与规则交给 AI，让 AI 生成/修改规则配置；  
  - 更新配置后重试抓取，成功则记录并复用；  
  - 形成一个“规则驱动 + AI 辅助修复”的可持续抓取系统，用于长期支撑 Amazon 链接的商品分析与上架优化。